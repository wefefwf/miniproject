<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main_layout}">
<head>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Gaegu:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote-bs4.min.js"></script>
    
    <style>
        :root {
            --soft-green: #f1f8e9;
            --point-green: #c5e1a5;
            --deep-green: #689f38;
            --text-brown: #455a64;
        }

        body {
            background-color: var(--soft-green) !important;
            margin: 0; padding: 0;
        }

        .diary-wrapper {
            background-color: var(--soft-green); 
            padding: 60px 0; 
            min-height: 100vh;
            display: flex; justify-content: center; align-items: center;
            font-family: 'Gaegu', cursive;
        }

        .diary-container {
            width: 1150px; min-height: 850px; background: #fff;
            display: flex; position: relative; border-radius: 50px;
            box-shadow: 0 20px 60px rgba(139, 195, 74, 0.15);
            border: 12px solid #fff;
        }

        .sidebar {
            width: 32%; background: linear-gradient(to bottom, #f1f8e9, #ffffff);
            padding: 50px 30px; display: flex; flex-direction: column; align-items: center;
            border-radius: 40px 0 0 40px; border-right: 2px dashed #dcedc8;
        }

        .profile-box {
            position: relative; padding: 15px 15px 40px 15px; background: #fff;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05); transform: rotate(-2deg);
            border-radius: 5px; margin-bottom: 25px;
        }
        
        .tape-deco {
            position: absolute; top: -10px; left: 50%; transform: translateX(-50%);
            width: 100px; height: 35px; background: rgba(197, 225, 165, 0.6);
            clip-path: polygon(0% 15%, 100% 0%, 95% 100%, 5% 85%); z-index: 10;
        }

        .main-content { width: 68%; padding: 50px; position: relative; }

        .section-title { 
            font-size: 2.5rem; color: var(--deep-green); margin-bottom: 25px; 
            display: inline-block; background: #f1f8e9; padding: 5px 25px; border-radius: 50px;
        }

        .list-item {
            background: #fdfefd; border-radius: 25px; margin-bottom: 12px;
            padding: 15px 25px; border: 2px solid #f1f8e9;
            transition: 0.3s; display: flex; justify-content: space-between; align-items: center;
        }

        /* íƒ­ ë””ìì¸ */
        .index-tabs { position: absolute; right: -45px; top: 60px; display: flex; flex-direction: column; gap: 10px; z-index: 100; }
        .tab {
            width: 45px; min-height: 90px; 
            background-color: var(--point-green) !important;
            writing-mode: vertical-rl;
            text-align: center; color: #558b2f; border-radius: 0 15px 15px 0;
            font-weight: bold; font-size: 1.2rem; box-shadow: 5px 0 10px rgba(0,0,0,0.05);
            display: flex; align-items: center; justify-content: center;
            text-decoration: none !important;
        }
        /* í˜„ì¬ ì„ íƒëœ íƒ­ ê°•ì¡° (ì„ íƒì‚¬í•­) */
        .tab-active { background: var(--deep-green) !important; color: white; }

        .btn-custom {
            background-color: #dcedc8 !important; 
            color: #558b2f !important; 
            border: 1px solid #c5e1a5 !important;
            padding: 12px 35px; font-size: 1.5rem; 
            border-radius: 50px; cursor: pointer;
            box-shadow: 0 4px 0 #c5e1a5 !important;
            transition: 0.2s; text-decoration: none;
            display: inline-block; font-weight: bold; outline: none;
        }

        .btn-custom:hover { 
            transform: translateY(2px); 
            background-color: #f1f8e9 !important; 
            box-shadow: 0 2px 0 #c5e1a5 !important;
        }

        .write-box {
            background: #fff; padding: 30px; border-radius: 35px;
            border: 2px solid #f1f8e9;
        }

        .note-editable { font-family: 'Gaegu', cursive !important; font-size: 1.2rem; }
    </style>
</head>
<body>
    <th:block layout:fragment="content">
        <div class="diary-wrapper">
            <div class="diary-container">
                <div class="index-tabs">
                    <th:block th:each="pet : ${petList}">
                        <a th:href="@{/diary/list(pet_id=${pet.petId})}" 
                           class="tab" 
                           th:classappend="${param.pet_id != null and param.pet_id[0] == #strings.toString(pet.petId)} ? 'tab-active' : ''"
                           th:text="${pet.name}">ê°•ì•„ì§€ì´ë¦„</a>
                    </th:block>
                </div>

                <div class="sidebar">
                    <div class="profile-box">
                        <div class="tape-deco"></div>
                        <img th:src="${petImage != null ? petImage : '/upload/pet/dog9.jpg'}" 
                             style="width: 200px; height: 200px; object-fit: cover; border-radius: 5px;">
                    </div>

                    <h2 style="font-size: 2.8rem; color: var(--deep-green); margin-bottom: 10px;">[[${petName}]] <span style="font-size: 1.5rem; opacity: 0.6;">Log</span></h2>

                    <div style="text-align: center; color: #455a64; background: #fff; padding: 15px 25px; border-radius: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.03);">
                        <p style="font-size: 1.5rem; margin-bottom: 5px;">ë°˜ê°€ì›Œìš”, <span style="color: var(--deep-green); font-weight: bold;">[[${session.user.name}]]</span>ë‹˜!</p>
                        <p style="font-size: 1.2rem; opacity: 0.8; margin: 0;">í¬ê·¼í•˜ê²Œ ìŒ“ì¸ ê¸°ë¡ <b>[[${#lists.size(diaryList)}]]ê°œ</b></p>
                    </div>

                    <a href="#write-section" class="btn-custom" style="margin-top: 50px;">ğŸŒ¿ ìƒˆ ì¶”ì–µ ë‚¨ê¸°ê¸°</a>
                </div>

                <div class="main-content">
                    <div class="content-section">
                        <div class="section-title">ìš°ë¦¬ì˜ ì¶”ì–µ ìˆ² ğŸŒ³</div>
                        <div class="list-box">
                            <div th:each="diary : ${diaryList}" class="list-item">
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <span style="font-size: 1.5rem;">ğŸƒ</span>
                                    <a th:href="@{/diary/detail(diary_id=${diary.diary_id})}" 
                                       style="font-size: 2rem; font-family: 'Nanum Pen Script'; color: #455a64; text-decoration: none;" 
                                       th:text="${diary.title}">ì œëª©</a>
                                </div>
                                <a th:href="@{/diary/delete(diary_id=${diary.diary_id})}" 
                                   onclick="return confirm('ì´ ê¸°ì–µì„ ì§€ìš¸ê¹Œìš”? ğŸ¥º')"
                                   style="text-decoration: none; color: #ffab91;">ì§€ìš°ê¸° ğŸ—‘ï¸</a>
                            </div>
                        </div>
                    </div>

                    <div class="content-section" id="write-section" style="margin-top: 40px;">
					    <div class="section-title">ì˜¤ëŠ˜ì˜ ë§‘ìŒ ê¸°ë¡ ğŸ–‹ï¸</div>
					    <div class="write-box">
					        <form action="/diary/save" method="post">
					            <input type="hidden" name="pet_id" 
					                   th:value="${param.pet_id != null ? param.pet_id : (petList != null && !petList.isEmpty() ? petList[0].petId : '')}">
					            
					            <input type="text" name="title" required placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" 
					                   style="font-family: 'Gaegu'; font-size: 1.6rem; border: none; border-bottom: 3px solid #f1f8e9; width: 100%; margin-bottom: 15px; outline: none;">
					            
					            <textarea id="summernote" name="content"></textarea>
					
					            <div class="text-center mt-4">
					                <button type="submit" class="btn-custom">
					                    ìˆ²ì— ì €ì¥í•˜ê¸° âœ¨
					                </button>
					            </div>
					        </form>
					    </div>
					</div>
                </div>
            </div>
        </div>

        <script>
            $(document).ready(function() {
                $('#summernote').summernote({
                    height: 200,
                    lang: 'ko-KR',
                    placeholder: 'ì˜¤ëŠ˜ ê°•ì•„ì§€ì™€ ì–´ë–¤ í’€ëƒ„ìƒˆë¥¼ ë§¡ì•˜ë‚˜ìš”?',
                    toolbar: [
                        ['style', ['bold', 'italic', 'underline']],
                        ['fontsize', ['fontsize']],
                        ['color', ['color']],
                        ['insert', ['picture', 'link']]
                    ]
                });
            });
        </script>
    </th:block>
</body>
</html>