<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.product_name} + ' - ReeFlo'">ìƒí’ˆ ìƒì„¸</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.css"/>
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick-theme.css"/>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root { --main-green: #4CAF50; --dark-green: #2E7D32; --bg-light: #f1f8e9; --text-dark: #333; }
        body { font-family: 'Noto Sans KR', sans-serif; background-color: #fff; color: var(--text-dark); }
        
        .detail-wrapper { max-width: 1200px; margin: 50px auto; padding: 0 20px; }
        .product-main { display: flex; gap: 40px; align-items: flex-start; }
        
        /* ìŠ¬ë¼ì´ë” ì˜ì—­ */
        .slider-container { width: 500px; background: var(--bg-light); border-radius: 20px; overflow: hidden; padding: 20px; }
        .slider img { width: 100%; height: 450px; object-fit: contain; border-radius: 15px; }
        
        /* ìƒí’ˆ ì •ë³´ ì˜ì—­ */
        .info-container { flex: 1; padding: 10px 0; }
        .brand-text { color: var(--main-green); font-weight: 700; font-size: 1.1rem; margin-bottom: 10px; }
        .product-name { font-size: 2.2rem; font-weight: 700; margin-bottom: 15px; }
        .price-box { font-size: 1.8rem; font-weight: 800; color: var(--dark-green); border-bottom: 2px solid #f5f5f5; padding-bottom: 20px; margin-bottom: 30px; }
        
        .desc-box { line-height: 1.8; color: #666; margin-bottom: 40px; min-height: 100px; }
        
        /* ë²„íŠ¼ ì˜ì—­ */
        .btn-group-custom { display: flex; gap: 15px; }
        .btn-cart { flex: 1; padding: 18px; border: 2px solid var(--main-green); color: var(--main-green); background: #fff; border-radius: 12px; font-weight: 700; font-size: 1.1rem; transition: 0.3s; }
        .btn-buy { flex: 2; padding: 18px; border: none; background: var(--main-green); color: #fff; border-radius: 12px; font-weight: 700; font-size: 1.1rem; transition: 0.3s; }
        .btn-buy:hover { background: var(--dark-green); }
        
        .back-link { display: inline-block; margin-top: 30px; color: #999; text-decoration: none; font-size: 0.9rem; }
        .back-link:hover { text-decoration: underline; }

        /* --- ìƒˆë¡œ ì¶”ê°€ëœ ì´ˆë¡ìƒ‰ ìƒì„¸ ì˜ì—­ ìŠ¤íƒ€ì¼ --- */
        .icon-circle-green { 
            width: 85px; height: 85px; background: #fff; border: 2px solid #e8f5e9; 
            border-radius: 50%; display: flex; align-items: center; justify-content: center; 
            margin: 0 auto; box-shadow: 0 4px 15px rgba(76, 175, 80, 0.1); 
        }
        .green-info-box { background-color: #f1f8e9; border: 1px solid #c8e6c9; }
        .table-light-green { background-color: #f9fbf9 !important; color: var(--dark-green) !important; font-weight: 600; }
        .custom-table th, .custom-table td { vertical-align: middle; font-size: 0.95rem; padding: 12px; }

        .slick-dots { bottom: 10px; }
        .slick-prev:before, .slick-next:before { color: var(--main-green) !important; }
    </style>
</head>
<body>
    <div th:replace="~{fragments/header :: header}"></div>

    <div class="detail-wrapper">
        <div class="product-main">
            <div class="slider-container">
                <div class="slider">
                    <img th:src="${product.image_url}" alt="main_img">
                    <img th:src="@{/upload/food/food1.jpg}" alt="food1">
                    <img th:src="@{/upload/food/food2.jpg}" alt="food2">
                </div>
            </div>

            <div class="info-container">
                <div class="brand-text">ReeFlo Pick</div>
                <h1 class="product-name" th:text="${product.product_name}">ìƒí’ˆ ì´ë¦„</h1>
                <div class="price-box" th:text="|â‚©${#numbers.formatInteger(product.price, 0, 'COMMA')}|">0ì›</div>
                
                <div class="desc-box">
                    <p th:text="${product.description}">ì—¬ê¸°ì— ìƒí’ˆ ìƒì„¸ ì„¤ëª…ì´ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
                </div>

                <div class="btn-group-custom">
                    <button id="addCartBtn" class="btn-cart" th:value="${product.product_id}">ì¥ë°”êµ¬ë‹ˆ</button>
                    <button class="btn-buy">ë°”ë¡œ êµ¬ë§¤í•˜ê¸°</button>
                </div>
                
                <a href="/productList" class="back-link">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
            </div>
        </div>

        <hr class="my-5" style="border-color: #eee;">

        <div class="product-description-wrapper">
            <div class="check-point-section mb-5">
                <h3 class="text-center fw-bold mb-4">ReeFlo <span style="color: var(--main-green);">Check</span> Point</h3>
                
                <div class="d-flex justify-content-around text-center mb-5">
                    <div class="check-item">
                        <div class="icon-circle-green mb-2">
                            <img src="https://img.icons8.com/fluency/48/star--v1.png" alt="í‰ì "/>
                        </div>
                        <p class="fw-bold mb-1" style="color: var(--dark-green);">4.9</p>
                        <small class="text-muted">í‰ì ì²´í¬</small>
                    </div>
                    <div class="check-item">
                        <div class="icon-circle-green mb-2">
                           <img src="https://img.icons8.com/color/48/guarantee--v1.png" alt="ì•ˆì‹¬"/>
                        </div>
                        <p class="fw-bold mb-1" style="color: var(--dark-green);">ì—†ìŒ</p>
                        <small class="text-muted">ë¦¬ì½œ ê²½í—˜</small>
                    </div>
                    <div class="check-item">
                        <div class="icon-circle-green mb-2">
                            <img src="https://img.icons8.com/fluency/48/leaf.png" alt="ì„±ë¶„"/>
                        </div>
                        <p class="fw-bold mb-1" style="color: var(--dark-green);">í†µê³¼</p>
                        <small class="text-muted">ì„±ë¶„ ê¸°ì¤€</small>
                    </div>
                </div>

                <div class="green-info-box p-4 rounded-4">
                    <p class="fw-bold mb-3" style="color: var(--dark-green); font-size: 1.1rem;">ğŸŒ¿ ReeFloì˜ ê±´ê°•í•œ ì•½ì†</p>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-3">
                            <strong style="color: #333;">â— ê¹Œë‹¤ë¡œìš´ ì„±ë¶„ ê²€ìˆ˜</strong><br>
                            <small class="text-muted">ë°˜ë ¤ë™ë¬¼ì—ê²Œ í•´ë¡œìš´ ì¸ê³µ ì²¨ê°€ë¬¼ ìœ ë¬´ë¥¼ ì—„ê²©íˆ í™•ì¸í•˜ì—¬ ì…ì ì‹œí‚µë‹ˆë‹¤.</small>
                        </li>
                        <li>
                            <strong style="color: #333;">â— ì‹ ì„ ë„ ë³´ì¥ ì‹œìŠ¤í…œ</strong><br>
                            <small class="text-muted">ì œì¡°ì¼ë¡œë¶€í„° ìµœì ì˜ í’ˆì§ˆì„ ìœ ì§€í•˜ëŠ” ìƒí’ˆë§Œì„ ì„ ë³„í•˜ì—¬ ë°œì†¡í•©ë‹ˆë‹¤.</small>
                        </li>
                    </ul>
                </div>
            </div>

            <div class="product-spec-section mt-5">
                <div class="d-flex align-items-center mb-3">
                    <div style="width: 4px; height: 18px; background-color: var(--main-green); margin-right: 10px;"></div>
                    <h4 class="fw-bold mb-0">ìƒí’ˆ ê³ ì‹œ ì •ë³´</h4>
                </div>
                <table class="table table-bordered custom-table">
                    <tbody>
                        <tr>
                            <th class="table-light-green w-25">í’ˆëª… ë° ëª¨ë¸ëª…</th>
                            <td th:text="${product.product_name}">ìƒí’ˆëª…</td>
                        </tr>
                        <tr>
                            <th class="table-light-green">ì›ë£Œêµ¬ì„±</th>
                            <td>íŒ¨í‚¤ì§€ ë³„ë„ í‘œê¸° ë° ìƒì„¸ ì„¤ëª… ì°¸ì¡°</td>
                        </tr>
                        <tr>
                            <th class="table-light-green">ì„±ë¶„êµ¬ì„±</th>
                            <td>ì¡°ë‹¨ë°± 5% ì´ìƒ, ì¡°ì§€ë°© 3% ì´ìƒ ë“± (ì œí’ˆë³„ ìƒì´)</td>
                        </tr>
                        <tr>
                            <th class="table-light-green">ì œì¡°êµ­ / ì œì¡°ì‚¬</th>
                            <td>ëŒ€í•œë¯¼êµ­ / ReeFlo íŒŒíŠ¸ë„ˆì‚¬</td>
                        </tr>
                        <tr>
                            <th class="table-light-green">ê³ ê°ì„¼í„°</th>
                            <td>02-1234-5678</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
                <div class="modal-header border-0 pb-0">
                    <h5 class="modal-title fw-bold">Cart</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="d-flex align-items-center p-3 mb-4" style="background-color: #f1f8e9; border-radius: 15px;">
                        <img th:src="${product.image_url}" width="70" height="70" class="rounded-3 me-3" style="object-fit: cover;">
                        <div class="text-start">
                            <p class="mb-1 fw-bold" th:text="${product.product_name}">ìƒí’ˆëª…</p>
                            <p class="mb-0 text-success fw-bold" th:text="|â‚©${#numbers.formatInteger(product.price, 0, 'COMMA')}|">ê°€ê²©</p>
                        </div>
                    </div>
                    <p class="fw-bold mb-0">ì¥ë°”êµ¬ë‹ˆì— ìƒí’ˆì„ ì„±ê³µì ìœ¼ë¡œ ë‹´ì•˜ìŠµë‹ˆë‹¤!</p>
                </div>
                <div class="modal-footer border-0 flex-column gap-2">
                    <a href="/cart/list" class="btn w-100 py-3 fw-bold" style="background-color: #FFD700; border-radius: 12px; color: #000; text-decoration:none;">ì¥ë°”êµ¬ë‹ˆ ë³´ê¸°</a>
                    <button type="button" class="btn w-100 py-3 fw-bold" data-bs-dismiss="modal" style="background-color: #f0f0f0; border-radius: 12px;">ê³„ì† ì‡¼í•‘</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/slick-carousel@1.8.1/slick/slick.min.js"></script>
    <script>
        $(document).ready(function(){
            // ìŠ¬ë¼ì´ë” ì„¤ì •
            $('.slider').slick({
                dots: true,
                infinite: true,
                speed: 500,
                fade: true,
                cssEase: 'linear'
            });

            // ì¥ë°”êµ¬ë‹ˆ í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
            $('#addCartBtn').click(function() {
                const p_id = $(this).val();
                
                $.ajax({
                    url: '/cart/add',
                    type: 'POST',
                    data: {
                        product_id: p_id,
                        count: 1
                    },
                    success: function(res) {
                        if(res === "success") {
                            const myModal = new bootstrap.Modal(document.getElementById('cartModal'));
                            myModal.show();
                        } else if(res === "login_required") {
                            alert("ë¡œê·¸ì¸ì´ í•„ìš”í•œ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤.");
                            location.href = "/loginForm";
                        }
                    },
                    error: function() {
                        alert("ì„œë²„ í†µì‹  ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
                    }
                });
            });
        });
    </script>
</body>
</html>